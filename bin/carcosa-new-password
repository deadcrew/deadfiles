#!/bin/bash

if [[ -z "$SECRET_DIR" ]]; then
    SECRET_DIR=$HOME/.secrets
fi

slug="${1:-}"
if [[ ! "${slug:-}" ]]; then
    slug=$(modal -lines 0)
fi

if [[ ! "${slug:-}" ]]; then
    echo "slug can't be empty"
    notify-send "carcosa" "slug can't be empty"
    exit 1
fi

password=$(pwgen 10 1)

{
    cd ~/.secrets
    carcosa -Ac "passwords/$slug" <<< "$password"
}

xclip -i -selection clipboard <<< "$password"
xclip -i -selection primary <<< "$password"

notify-send "carcosa" "password copied into buffer"
