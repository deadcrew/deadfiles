#!/bin/bash

if [[ -z "$REPO" ]]; then
    REPO=$HOME/.secrets
fi


slug="${1:-}"
if [[ ! "${slug:-}" ]]; then
    relative=$(realpath --relative-to="$HOME" "$REPO")
    slug=$(modal -lines 0 -mesg "repo: ~/$relative")
fi

if [[ ! "${slug:-}" ]]; then
    exit 1
fi

password=$(pwgen -y 14 1)

xclip -i -selection clipboard <<< "$password"
xclip -i -selection primary <<< "$password"

notify-send "carcosa" "password copied into buffer"

carcosa -p $REPO -Ac "passwords/$slug" <<< "$password"
