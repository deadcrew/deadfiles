#!/bin/bash

set -euo pipefail

account="$1"

config() {
    cat ~/.mcabber/account.$account
    echo

    cat ~/.mcabber/mcabberrc.base
    echo

    cat ~/.mcabber/mcabberrc.$BACKGROUND
    echo

    cat ~/.mcabber/mcabberrc.$account
    echo

    if [ -f ~/.mcabber/token.$account ]; then
        channels=$(
            slack-get-jabber-rooms $account $(cat ~/.mcabber/token.$account) \
                | tr '\n' ','
        )
        echo "set autojoin = $channels"
    fi
}

mcabber -f <(config)
