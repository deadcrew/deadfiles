#!/bin/bash
###
### gorun compiles (if modified) and runs project
###
### gorun [<directory>]
###

set -euo pipefail

oldpwd="$(pwd)"
if [[ "${1:-}" ]]; then
    if [[ -d "$1" ]]; then
        cd "$1"
        shift
    fi
fi

mod=""
if [[ "${GO111MODULE:-}" == "on" ]]; then
    mod="-mod vendor"
fi

name=$(basename "$(pwd)")
GOBIN=$(pwd) go install $mod
bin=$(readlink -f "$(pwd)/$name")

cd "$oldpwd"

exec "$bin" "${@}"
