#!/bin/bash
###
### gorun compiles (if modified) and runs project
###
### gorun [<directory>]
###

set -euo pipefail

oldpwd="$(pwd)"
if [[ "${1:-}" ]]; then
    if [[ -d "$1" ]]; then
        cd "$1"
        shift
    fi
fi

mod=""
if [[ "${GO111MODULE:-}" == "on" ]]; then
    mod="-mod vendor"
fi

name=$(basename "$(pwd)")
go install -gcflags "-trimpath $GOPATH" -asmflags "-trimpath $GOPATH" $mod

cd "$oldpwd"

exec "$GOPATH/bin/$name" "${@}"
